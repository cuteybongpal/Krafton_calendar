<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>달력 + 사이드바 + 로그인/회원가입 + 일정관리</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f4f4f4; }
    .sidebar {
      background-color: #fff;
      min-height: 100vh;
      padding: 20px;
      box-shadow: 2px 0 6px rgba(0,0,0,0.1);
    }
    .widget {
      background: #f9f9f9;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      text-align: center;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: .2rem;
    }
    .calendar-cell {
      height: 120px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      border-radius: .5rem;
      font-size: .75rem;
      cursor: pointer;
      padding: 4px;
      position: relative;
    }
    .calendar-cell.disabled { color: #bbb; cursor: not-allowed; }
    .calendar-cell.today { border: 1px solid #0d6efd; }
    .calendar-cell.selected { background-color: #0d6efd; color: white; }
    .calendar-event {
      font-size: .65rem;
      color: #0d6efd;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
      width: 100%;
    }
    .weekday {
      font-weight: 600;
      text-align: center;
      font-size: .75rem;
      padding: .1rem 0;
    }
  </style>
</head>
<body>

<div class="container-fluid">
  <div class="row">
    
    <!-- 왼쪽 사이드바 -->
    <div class="col-3 sidebar">
      <div class="widget">
        <h5>오늘 날짜</h5>
        <h4 id="today-date"></h4>
      </div>
      <div class="widget">
        <h5>오늘 급식</h5>
        <p id="mealMenu">
          A : 된장찌개, 야채볶음밥
        </p>
        <button class="btn btn-sm btn-secondary" id="editMealBtn">편집</button>
      </div>
      <div class="widget d-flex flex-column gap-2">
        <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#signupModal">회원가입</button>
        <button class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#loginModal">로그인</button>
      </div>
    </div>

    <!-- 오른쪽 달력 -->
    <div class="col-9 p-4">
      <div class="card shadow-sm">
        <div class="card-body">

          <!-- 달력 헤더 -->
          <div class="d-flex justify-content-between align-items-center mb-3">
            <button class="btn btn-outline-secondary btn-sm" id="prevBtn">&lt;</button>
            <h5 class="mb-0" id="monthLabel"></h5>
            <button class="btn btn-outline-secondary btn-sm" id="nextBtn">&gt;</button>
          </div>

          <!-- 요일 헤더 -->
          <div class="calendar-grid text-muted mb-1">
            <div class="weekday">월</div>
            <div class="weekday">화</div>
            <div class="weekday">수</div>
            <div class="weekday">목</div>
            <div class="weekday">금</div>
            <div class="weekday text-danger">토</div>
            <div class="weekday text-danger">일</div>
          </div>

          <!-- 날짜 그리드 -->
          <div id="calendarGrid" class="calendar-grid"></div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- 회원가입 모달 -->
<div class="modal fade" id="signupModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">회원가입</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="signupForm">
          <div class="mb-3"><label class="form-label">이메일</label>
            <input type="email" class="form-control" id="signupEmail" required>
          </div>
          <div class="mb-3"><label class="form-label">비밀번호</label>
            <input type="password" class="form-control" id="signupPassword" required>
          </div>
          <button type="submit" class="btn btn-primary w-100">회원가입</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- 로그인 모달 -->
<div class="modal fade" id="loginModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">로그인</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="loginForm">
          <div class="mb-3"><label class="form-label">이메일</label>
            <input type="email" class="form-control" id="loginEmail" required>
          </div>
          <div class="mb-3"><label class="form-label">비밀번호</label>
            <input type="password" class="form-control" id="loginPassword" required>
          </div>
          <button type="submit" class="btn btn-success w-100">로그인</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- 일정 관리 모달 -->
<div class="modal fade" id="eventModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">일정 관리</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <h6 id="eventDateLabel"></h6>
        <ul id="eventList" class="list-group mb-3"></ul>

        <form id="eventForm" class="d-flex flex-column gap-2">
          <div class="d-flex gap-2">
            <input type="date" class="form-control" id="startDate" required>
            <input type="date" class="form-control" id="endDate" required>
          </div>
          <div class="d-flex gap-2">
            <input type="time" class="form-control" id="startTime" required>
            <input type="time" class="form-control" id="endTime" required>
          </div>
          <input type="text" class="form-control" id="eventText" placeholder="일정 내용" required>
          <button type="submit" class="btn btn-primary">추가</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- 일정 수정 모달 -->
<div class="modal fade" id="editEventModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">일정 수정</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="editEventForm" class="d-flex flex-column gap-2">
          <input type="hidden" id="editDateKey">
          <input type="hidden" id="editIndex">

          <div class="d-flex gap-2">
            <input type="time" class="form-control" id="editStartTime" required>
            <input type="time" class="form-control" id="editEndTime" required>
          </div>
          <input type="text" class="form-control" id="editText" placeholder="일정 내용" required>
          <button type="submit" class="btn btn-primary">저장</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- 급식 메뉴 편집 모달 (B 제거됨) -->
<div class="modal fade" id="editMealModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">급식 메뉴 수정</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="mealForm">
          <div class="mb-3">
            <label class="form-label">A 메뉴</label>
            <input type="text" class="form-control" id="mealA">
          </div>
          <button type="submit" class="btn btn-primary w-100">저장</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  document.getElementById("today-date").innerText = new Date().toISOString().split('T')[0];

  const MIN_DATE = new Date(2025, 8, 1);
  const MAX_DATE = new Date(2026, 0, 31);
  let current = new Date(2025, 8, 1);
  let selected = null;
  const events = {};
  const monthLabel = document.getElementById("monthLabel");
  const prevBtn = document.getElementById("prevBtn");
  const nextBtn = document.getElementById("nextBtn");
  const grid = document.getElementById("calendarGrid");

  function formatDateKey(date) { return date.toISOString().split("T")[0]; }
  let selectedDateKey = null;

  function renderCalendar() {
    monthLabel.textContent = `${current.getFullYear()}년 ${current.getMonth()+1}월`;
    prevBtn.disabled = new Date(current.getFullYear(), current.getMonth(), 1) <= MIN_DATE;
    nextBtn.disabled = new Date(current.getFullYear(), current.getMonth()+1, 0) >= MAX_DATE;
    grid.innerHTML = "";
    const startDay = new Date(current.getFullYear(), current.getMonth(), 1);
    const endDay = new Date(current.getFullYear(), current.getMonth()+1, 0);
    const startWeekDay = (startDay.getDay() + 6) % 7;

    let days = [];
    for (let i=0; i<startWeekDay; i++) days.push(null);
    for (let d=1; d<=endDay.getDate(); d++) days.push(new Date(current.getFullYear(), current.getMonth(), d));

    days.forEach(date => {
      const cell = document.createElement("div");
      cell.className = "calendar-cell border";

      if (date) {
        const key = formatDateKey(date);
        const dateDiv = document.createElement("div");
        dateDiv.textContent = date.getDate();
        cell.appendChild(dateDiv);

        const today = new Date();
        if (date.toDateString() === today.toDateString()) cell.classList.add("today");
        if (selected && date.toDateString() === selected.toDateString()) cell.classList.add("selected");
        if (date < MIN_DATE || date > MAX_DATE) {
          cell.classList.add("disabled");
        } else {
          cell.addEventListener("click", () => {
            selected = date;
            selectedDateKey = key;
            renderEventModal(key);
            new bootstrap.Modal(document.getElementById("eventModal")).show();
            renderCalendar();
          });
        }

        if (events[key]) {
          const firstEvent = events[key][0];
          const eventDiv = document.createElement("div");
          eventDiv.className = "calendar-event";
          eventDiv.textContent = `${firstEvent.start}~${firstEvent.end} ${firstEvent.text}`;
          eventDiv.setAttribute("data-bs-toggle", "tooltip");
          eventDiv.setAttribute("title", events[key].map(ev => `${ev.start}~${ev.end} ${ev.text}`).join("\n"));
          cell.appendChild(eventDiv);
        }
      }
      grid.appendChild(cell);
    });

    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(el => new bootstrap.Tooltip(el));
  }

  function renderEventModal(dateKey) {
    document.getElementById("eventDateLabel").textContent = dateKey;
    const list = document.getElementById("eventList");
    list.innerHTML = "";

    if (events[dateKey]) {
      events[dateKey].sort((a,b) => a.start.localeCompare(b.start)).forEach((ev, idx) => {
        const li = document.createElement("li");
        li.className = "list-group-item d-flex justify-content-between align-items-center";
        li.innerHTML = `
          <span>${ev.start}~${ev.end} - ${ev.text}</span>
          <div class="d-flex gap-2">
            <button class="btn btn-sm btn-warning">수정</button>
            <button class="btn btn-sm btn-danger">삭제</button>
          </div>`;
        li.querySelector(".btn-danger").addEventListener("click", () => {
          events[dateKey] = events[dateKey].filter(e => e !== ev);
          if (events[dateKey].length === 0) delete events[dateKey];
          renderEventModal(dateKey);
          renderCalendar();
        });
        li.querySelector(".btn-warning").addEventListener("click", () => {
          document.getElementById("editDateKey").value = dateKey;
          document.getElementById("editIndex").value = idx;
          document.getElementById("editStartTime").value = ev.start;
          document.getElementById("editEndTime").value = ev.end;
          document.getElementById("editText").value = ev.text;
          new bootstrap.Modal(document.getElementById("editEventModal")).show();
        });
        list.appendChild(li);
      });
    }
  }

  document.getElementById("eventForm").addEventListener("submit", e => {
    e.preventDefault();
    const startDate = new Date(document.getElementById("startDate").value);
    const endDate = new Date(document.getElementById("endDate").value);
    const startTime = document.getElementById("startTime").value;
    const endTime = document.getElementById("endTime").value;
    const text = document.getElementById("eventText").value;

    let day = new Date(startDate);
    while (day <= endDate) {
      const key = formatDateKey(day);
      if (!events[key]) events[key] = [];
      if (startDate.toDateString() === endDate.toDateString()) {
        events[key].push({ start: startTime, end: endTime, text });
      } else if (day.toDateString() === startDate.toDateString()) {
        events[key].push({ start: startTime, end: "23:59", text });
      } else if (day.toDateString() === endDate.toDateString()) {
        events[key].push({ start: "00:00", end: endTime, text });
      } else {
        events[key].push({ start: "00:00", end: "23:59", text });
      }
      day.setDate(day.getDate() + 1);
    }
    document.getElementById("eventForm").reset();
    renderEventModal(selectedDateKey);
    renderCalendar();
  });

  document.getElementById("editEventForm").addEventListener("submit", e => {
    e.preventDefault();
    const dateKey = document.getElementById("editDateKey").value;
    const idx = parseInt(document.getElementById("editIndex").value);
    const start = document.getElementById("editStartTime").value;
    const end = document.getElementById("editEndTime").value;
    const text = document.getElementById("editText").value;
    if (events[dateKey] && events[dateKey][idx]) {
      events[dateKey][idx] = { start, end, text };
    }
    bootstrap.Modal.getInstance(document.getElementById("editEventModal")).hide();
    renderEventModal(dateKey);
    renderCalendar();
  });

  prevBtn.addEventListener("click", () => { current.setMonth(current.getMonth() - 1); renderCalendar(); });
  nextBtn.addEventListener("click", () => { current.setMonth(current.getMonth() + 1); renderCalendar(); });
  renderCalendar();

  document.getElementById("signupForm").addEventListener("submit", e => {
    e.preventDefault();
    alert("회원가입 완료! (서버 연동 필요)");
    bootstrap.Modal.getInstance(document.getElementById("signupModal")).hide();
  });
  document.getElementById("loginForm").addEventListener("submit", e => {
    e.preventDefault();
    alert("로그인 성공! (서버 연동 필요)");
    bootstrap.Modal.getInstance(document.getElementById("loginModal")).hide();
  });

  // 급식 메뉴 편집 (B 제거)
  const mealMenu = document.getElementById("mealMenu");
  const editMealBtn = document.getElementById("editMealBtn");
  editMealBtn.addEventListener("click", () => {
    const line = mealMenu.innerHTML.replace("A : ", "");
    document.getElementById("mealA").value = line;
    new bootstrap.Modal(document.getElementById("editMealModal")).show();
  });

  document.getElementById("mealForm").addEventListener("submit", e => {
    e.preventDefault();
    const a = document.getElementById("mealA").value;
    mealMenu.innerHTML = `A : ${a}`;
    bootstrap.Modal.getInstance(document.getElementById("editMealModal")).hide();
  });
</script>
</body>
</html>
